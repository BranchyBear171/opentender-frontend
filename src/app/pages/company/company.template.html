<section class="container-outer authority entity" *ngIf="!company">
	<section class="container">
		<div class="entity-title">Company</div>
		<div *ngIf="error">Error: {{error}}</div>
		<div *ngIf="!error">Loading...</div>
	</section>
</section>

<section class="container-outer company entity" *ngIf="company">
	<section class="container">
		<div class="entity-title"><i class="icon-office"></i> Company</div>
		<div class="info-links">
			<div class="info-link-box">
				Read more about tender legislation<br>
				<a target="_blank" href="http://europam.eu/?module=legislation&country={{ country.name }}"><i class="icon-new-tab"></i> EUROPAM</a>
			</div>
			<div class="info-link-box">
				Search this company at<br>
				<a target="_blank" href="http://openinterests.eu/entities?q={{ company.name | encodeURIComponent }}"><i class="icon-new-tab"></i> OpenInterests.eu</a><br>
				<a target="_blank" href="https://register.openownership.org/search?utf8=%E2%9C%93&q={{ company.name | encodeURIComponent }}"><i class="icon-new-tab"></i> OpenOwnership.org</a><br>
				<a target="_blank" href="http://farmsubsidy.openspending.org/search/?q={{ company.name | encodeURIComponent }}"><i class="icon-new-tab"></i> FarmSubsidy.org</a>
			</div>
		</div>
		<h1>{{company.name | nameGuard}}</h1>
		<tender-body-address [address]="company.address"></tender-body-address>
	</section>

	<section class="container" *ngIf="similar.length > 0">
		<div class="similars">
			<div class="title">Similar Companies</div>
			<div class="similar" *ngFor="let sim of similar">
				<a [routerLink]="['/company/'+sim.body.groupId]" title="Click to jump to the company profile"><i class="icon-office"></i> </a>
				<a (click)="toggleSimilar(sim)" title="Click to {{search_similars[sim.body.groupId]?'exclude':'include'}} into view">{{search_similars[sim.body.groupId]?'-':'+'}} <span>{{sim.body.name | nameGuard}}</span></a>
			</div>
		</div>
		<div class="debug_groupids clickable" style="font-size: 0.8em">
			<div (click)="showDebugGroupIds = !showDebugGroupIds">[Click to show all groupId bodies - this function is only for debugging and will be removed in final portals]</div>
			<div *ngIf="showDebugGroupIds">
				<div class="similar">
					<a [routerLink]="['/company/'+company.groupId]" title="Click to jump to the company profile">Current</a>
					<pre>{{plain(company)}}</pre>
				</div>
				<div class="similar" *ngFor="let sim of similar; let i = index;">
					<a [routerLink]="['/company/'+sim.body.groupId]" title="Click to jump to the company profile">Similar {{i+1}}</a>
					<pre>{{plain(sim.body)}}</pre>
				</div>
			</div>
		</div>
	</section>

	<section class="container container-margin">
		<h2>Indicators</h2>
		<div class="container slab-beta-light container-padded-large">
			<div class="container">
				<div class="container-left-6" *ngIf="charts.bids_in_years.visible">
					<div class="title">Number of Contract Bids awarded per Year</div>
					<ngx-charts-bar-vertical
							class="chart-container"
							[chart]="charts.bids_in_years.chart"
							[data]="charts.bids_in_years.data"
							(select)="charts.bids_in_years.select($event)"
							(legendLabelClick)="charts.bids_in_years.onLegendLabelClick($event)">
					</ngx-charts-bar-vertical>
				</div>
				<div class="container-left-6" *ngIf="charts.cpvs_code_main.visible">
					<div class="title">Structure of Activity (CPV)</div>
					<ngx-charts-pie-chart
							class="chart-container"
							[chart]="charts.cpvs_code_main.chart"
							[data]="charts.cpvs_code_main.data"
							(legendLabelClick)="charts.cpvs_code_main.onLegendLabelClick($event)"
							(select)="charts.cpvs_code_main.select($event)">
					</ngx-charts-pie-chart>
				</div>
			</div>
			<div class="container">
				<div class="container-left-6">
					<div class="title">Total Number of Contracts</div>
					<div class="stats">
						<ul>
							<li><span>Tenders</span><span>{{vis.tenders_total}}</span></li>
							<li><span>Lots</span><span>{{vis.lots_total}}</span></li>
							<li><span>Bids</span><span>{{vis.bids_total}}</span></li>
							<li><span>Bids awarded</span><span>{{vis.bids_awarded}}</span></li>
						</ul>
					</div>
				</div>
				<div class="container-left-6">
					<div class="title">Total Contract Values awarded <i class="icon-info" ngx-tooltip [tooltipTitle]="'Net amount of final price of awarded bids is used to calculate the sum'"></i></div>
					<div *ngFor="let val of vis.sum_prices">
						<span>{{val.currency | formatCurrency}}</span> <span>{{val.value | formatCurrencyValue}}</span>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="container container-margin">
		<h2>Main buyers</h2>
		<div class="container">
			<div class="container-left-6">
				<table class="tables">
					<tr>
						<th>Awarded Bids</th>
						<th>Buyer</th>
					</tr>
					<tr *ngFor="let val of vis.buyers">
						<td>{{val.value}}</td>
						<td>
							<tender-body-line [body]="val.body" [link]="'/authority/'+val.body.groupId"></tender-body-line>
						</td>
					</tr>
				</table>
			</div>
			<div class="container-left-6">

			</div>
		</div>
	</section>

	<section class="container">
		<tender-table [search_cmd]="search_cmd" [columnIds]="columnIds" [title]="'Tenders'" (searchChange)="searchChange($event);"></tender-table>
	</section>
</section>
